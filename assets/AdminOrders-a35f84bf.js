import{S as h}from"./sweetalert2.all-4fbfe73e.js";import{_ as g,o,c as d,b as e,t as l,n as f,F as u,p as b,I as y,L as M,a as w,r as _,d as p,H as $}from"./index-97dc42a3.js";import{P as D}from"./PaginationComponent-95df0270.js";import{D as L}from"./DeleteModal-29747747.js";import{M as T}from"./modal-a1bbae86.js";import{v as V}from"./vueLoadingStore-a0b8f305.js";const B={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},orderModal:null,tempOrder:{},isPaid:!1}},emits:["update-order","date"],watch:{order(){this.tempOrder=this.order}},methods:{openModal(){this.orderModal.show()},hideModal(){this.orderModal.hide()},date(r){const s=new Date(r*1e3);return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()}`}},mounted(){this.orderModal=new T(this.$refs.orderModal)}},E={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},A={class:"modal-dialog modal-xl",role:"document"},S={class:"modal-content border-0"},U=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I={class:"modal-body"},K={class:"row"},R={class:"col-md-4"},F=e("h3",null,"用戶資料",-1),H={class:"table"},N={key:0},j=e("th",{style:{width:"100px"}},"姓名",-1),q=e("th",null,"Email",-1),z=e("th",null,"電話",-1),Y=e("th",null,"地址",-1),G={class:"col-md-8"},J=e("h3",null,"訂單細節",-1),Q={class:"table"},W=e("th",{style:{width:"100px"}},"訂單編號",-1),X=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),oe={key:0,class:"text-success"},de={key:1,class:"text-muted"},re=e("th",null,"總金額",-1),le=e("h3",null,"選購商品",-1),ne={class:"table"},ie=e("thead",null,[e("tr")],-1),ae={class:"text-end"},ce={class:"d-flex justify-content-end"},he={class:"form-check"},ue={class:"form-check-label",for:"flexCheckDefault"},_e={key:0},pe={key:1},me={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function fe(r,s,k,x,t,i){return o(),d("div",E,[e("div",A,[e("div",S,[U,e("div",I,[e("div",K,[e("div",R,[F,e("table",H,[t.tempOrder.user?(o(),d("tbody",N,[e("tr",null,[j,e("td",null,l(t.tempOrder.user.name),1)]),e("tr",null,[q,e("td",null,l(t.tempOrder.user.email),1)]),e("tr",null,[z,e("td",null,l(t.tempOrder.user.tel),1)]),e("tr",null,[Y,e("td",null,l(t.tempOrder.user.address),1)])])):f("",!0)])]),e("div",G,[J,e("table",Q,[e("tbody",null,[e("tr",null,[W,e("td",null,l(t.tempOrder.id),1)]),e("tr",null,[X,e("td",null,l(i.date(t.tempOrder.create_at)),1)]),e("tr",null,[Z,e("td",null,[t.tempOrder.paid_date?(o(),d("span",ee,l(i.date(t.tempOrder.paid_date)),1)):(o(),d("span",te,"時間不正確"))])]),e("tr",null,[se,e("td",null,[t.tempOrder.is_paid?(o(),d("strong",oe,"已付款")):(o(),d("span",de,"尚未付款"))])]),e("tr",null,[re,e("td",null,l(t.tempOrder.total),1)])])]),le,e("table",ne,[ie,e("tbody",null,[(o(!0),d(u,null,b(t.tempOrder.products,a=>(o(),d("tr",{key:a.id},[e("th",null,l(a.product.title),1),e("td",null,l(a.qty)+" / "+l(a.product.unit),1),e("td",ae,l(a.final_total),1)]))),128))])]),e("div",ce,[e("div",he,[y(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[0]||(s[0]=a=>t.tempOrder.is_paid=a)},null,512),[[M,t.tempOrder.is_paid]]),e("label",ue,[t.tempOrder.is_paid?(o(),d("span",_e,"已付款")):(o(),d("span",pe,"未付款"))])])])])])]),e("div",me,[Oe,e("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=()=>r.$emit("update-order",t.tempOrder))},"修改付款狀態")])])])],512)}const be=g(B,[["render",fe]]),{VITE_APP_URL:m,VITE_APP_PATH:O}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"zxcv123",BASE_URL:"/Vue3_Barbecue/",MODE:"production",DEV:!1,PROD:!0},ge={data(){return{orders:[],tempOrder:{},page:{},currentPage:1,isOrder:!1}},methods:{...w(V,["showLoading","hideLoading"]),getOrders(r=1){this.currentPage=r,this.showLoading(),this.$http.get(`${m}v2/api/${O}/admin/orders?page=${r}`).then(s=>{this.orders=s.data.orders,this.page=s.data.pagination,this.hideLoading()}).catch(s=>{h.fire({title:s.response.data.message,icon:"error",confirmButtonText:"OK"}),this.hideLoading()})},openModal(r,s){r==="edit"?(this.$refs.orderModal.openModal(),this.tempOrder={...s}):r==="deleteOrder"&&(this.$refs.delOrderModal.opendelModal(),this.tempOrder={...s},this.isOrder=!0)},deleteOrder(){this.$http.delete(`${m}v2/api/${O}/admin/order/${this.tempOrder.id}`).then(r=>{h.fire({title:r.data.message,icon:"success",confirmButtonText:"OK"}),this.getOrders(this.currentPage),this.$refs.delOrderModal.hidedelModal()}).catch(r=>{h.fire({title:r.response.data.message,icon:"error",confirmButtonText:"OK"})})},updateOrder(r){this.tempOrder=r,this.tempOrder.is_paid?this.tempOrder.paid_date=Math.round(new Date().getTime()/1e3):this.tempOrder.is_paid||(this.tempOrder.paid_date=""),this.$http.put(`${m}v2/api/${O}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(s=>{h.fire({title:s.data.message,icon:"success",confirmButtonText:"OK"}),this.getOrders(this.currentPage),this.$refs.orderModal.hideModal()}).catch(s=>{h.fire({title:s.response.data.message,icon:"error",confirmButtonText:"OK"})})},date(r){return new Date(r*1e3).toLocaleDateString()}},mounted(){this.getOrders()},components:{PaginationComponent:D,DeleteModal:L,OrderModal:be}},ye={class:"container"},Me={class:"table mt-4"},ke=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),xe=["textContent"],ve={class:"list-unstyled"},Pe={class:"text-right"},Ce={class:"form-check form-switch"},we=["id","onUpdate:modelValue","onChange"],$e=["for"],De={key:0},Le={key:1},Te={class:"btn-group"},Ve=["onClick"],Be=["onClick"];function Ee(r,s,k,x,t,i){const a=_("OrderModal"),v=_("DeleteModal"),P=_("PaginationComponent");return o(),d("div",ye,[e("table",Me,[ke,e("tbody",null,[(o(!0),d(u,null,b(t.orders,n=>(o(),d(u,{key:n.id},[t.orders.length?(o(),d("tr",{key:0,class:$({"text-secondary":!n.is_paid})},[e("td",null,l(i.date(n.create_at)),1),e("td",null,[n.user?(o(),d("span",{key:0,textContent:l(n.user.email)},null,8,xe)):f("",!0)]),e("td",null,[e("ul",ve,[(o(!0),d(u,null,b(n.products,(c,C)=>(o(),d("li",{key:C},l(c.product.title)+" 數量："+l(c.qty)+" "+l(c.product.unit),1))),128))])]),e("td",Pe,l(n.total),1),e("td",null,[e("div",Ce,[y(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${n.id}`,"onUpdate:modelValue":c=>n.is_paid=c,onChange:()=>i.updateOrder(n)},null,40,we),[[M,n.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${n.id}`},[n.is_paid?(o(),d("span",De,"已付款")):(o(),d("span",Le,"未付款"))],8,$e)])]),e("td",null,[e("div",Te,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>i.openModal("edit",n)},"檢視",8,Ve),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>i.openModal("deleteOrder",n)},"刪除",8,Be)])])],2)):f("",!0)],64))),128))])]),p(a,{ref:"orderModal",order:t.tempOrder,onUpdateOrder:i.updateOrder},null,8,["order","onUpdateOrder"]),p(v,{ref:"delOrderModal","temp-product":t.tempOrder,"delete-product":i.deleteOrder,"is-order":t.isOrder,"temp-order":t.tempOrder},null,8,["temp-product","delete-product","is-order","temp-order"]),p(P,{pages:t.page,"get-data":i.getOrders},null,8,["pages","get-data"])])}const Fe=g(ge,[["render",Ee]]);export{Fe as default};
